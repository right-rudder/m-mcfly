---
import HeroFull from "../components/HeroFull.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import ContactForm from "../components/ContactForm.astro";
import enrollmentData from "../data/forms/enrollment.js";
import CTAWhyFly from "../components/CTAWhyFly.astro";
import InstagramFeed from "../components/InstagramFeed.astro";
import CTAVideo from "../components/CTAVideo.astro";
import FAQSection from "../components/react/FAQs.jsx";
import newcomerFAQs from "../data/newpilotsFAQs.js";
import CTAIntroFlight from "../components/CTAIntroFlight.astro";
import TrainingsSlider from "../components/react/TrainingsSlider";
import { getCollection } from "astro:content";
import { itemsMap } from "../lib/itemsMap.js";

const trainings = await getCollection("trainings");

const priority = (entry) => {
  // allow manual override via frontmatter: `order: 0|1|2|3`
  if (typeof entry.data?.order === "number") return entry.data.order;

  const slug = (entry.slug || "").toLowerCase();
  const title = (entry.data?.title || "").toLowerCase();
  const text = `${slug} ${title}`;

  if (text.includes("private")) return 0;           // Private Pilot
  if (text.includes("instrument")) return 1;        // Instrument Rating
  if (text.includes("commercial")) return 2;        // Commercial Pilot
  if (
    /instructor|cfi|cfii|flight[-\s]?instructor/.test(text)
  ) return 3;                                       // Instructor (CFI/CFII)

  return 99; // anything else to the end
};

const trainingsSorted = trainings
  .slice()
  .sort((a, b) => {
    const pa = priority(a);
    const pb = priority(b);
    if (pa !== pb) return pa - pb;
    return (a.data?.title || "").localeCompare(b.data?.title || "");
  });

const items = itemsMap(trainingsSorted);

---

<BaseLayout>
  <HeroFull
    data={{
      eyebrow: "First Time Pilots",
      title: "Your Journey Begins Here",
      paragraph:
        "Take the first step towards your pilot's license with our tailored programs for new aviators.",
      styling: "",
      image: "/src/assets/stock/stock-pilot-training-cable-california-los-angeles-flying-lessons.jpg",
      alt: "New pilot receiving flight instruction in a small aircraft",
    }}
  />
  <CTAVideo />

  <CTAWhyFly />
  <InstagramFeed />
  <TrainingsSlider items={items} client:only />
  <FAQSection faqs={newcomerFAQs} client:visible />
  <CTAIntroFlight />

  <ContactForm content={enrollmentData} />
</BaseLayout>
